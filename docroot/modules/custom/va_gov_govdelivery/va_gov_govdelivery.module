<?php

/**
 * @file
 * Module hooks for va_gov_govdelivery module.
 */

use Drupal\Core\Form\FormStateInterface;

/**
 * Implements hook_theme().
 */
function va_gov_govdelivery_theme($existing, $type, $theme, $path) {
  return [
    'va_gov_body_alert' => [
      'path' => drupal_get_path('module', 'va_gov_govdelivery') . '/templates',
      'template' => 'va-gov-body-alert',
      'variables' => [
        'alert_title' => '',
        'alert_type' => '',
        'date_time' => '',
        'message' => '',
        'ops_page_url' => '',
        'situation_update' => FALSE,
        'vamc_name' => '',
        'vamc_url' => '',
      ],
    ],
  ];
}

/**
 * Implements hook_form_alter().
 */
function va_gov_govdelivery_form_alter(&$form, FormStateInterface $form_state, $form_id) {
  if ($form_id === 'node_full_width_banner_alert_edit_form') {
    $node = $form_state->getFormObject()->getEntity();
    if ($node->isPublished() || ($node->moderation_state->value === 'published')) {
      // Disable send email field, this form will only send initial email once.
      // @todo Check node revisions in addition to current state, disable this
      // field if it was ever published.
      $form['field_operating_status_sendemail']['widget']['#disabled'] = TRUE;
    }
  }
}
